<!doctype html>
<html>
	<head>
		<title>
			Journal
		</title>
		<script src="https://epicenterprograms.github.io/standards/behavior/general.js"></script>
		<script src="behavior.js"></script>
		<script>
			S.listen("searchButton", "click", function () {
				if (S.getId("searchText").value.trim()) {
					let text = S.getId("searchText").value.trim();
					let query = "";
					if (text.search(/p.*\d+/) > -1) {
						query = "?p=" + text.match(/\d+/)[0];
					} else if (text.search(/t.*\d+/) > -1) {
						query = "?t=" + text.match(/\d+/)[0];
					} else {
						query = "?hint=" + encodeURIComponent(text);
					}
					window.location.href = "search" + query;
				}
			});

			S.listen("peopleLister", "click", function () {
				let table = document.createElement("table");
				table.className = "conversation";
				S.forEach(people.slice(1), function (person, index) {
					let row = table.insertRow(-1);
					row.appendChild(document.createElement("td"));
					row.appendChild(document.createElement("td"));
					row.children[0].textContent = "p" + index;
					row.children[1].textContent = person.fullName;
				});
			});

			S.onLoad(function () {
				if (window.location.href.includes("?")) {
					let query = window.location.href.slice(window.location.href.indexOf("?")).split("=");
					if (query[0] == "p") {

					} else if (query[0] == "t") {

					} else if (query[0] == "hint") {
						let hint = decodeURIComponent(query[1]);
						S.forEach(people, function (person, index) {
							if (person.name.includes(hint) || person.fullName.includes(hint)) {
								let listItem = document.createElement("li");
								listItem.innerHTML = '<a href="search?p=' + index + '">' + person.name + "</a><br>(" + person.fullName + ")<br>person number = " + index;
								S.getId("result").appendChild(listItem);
							}
						});
					} else {
						S.getId("result").textContent = "An invalid type of search was attempted.";
					}
				}
			});
		</script>
		<link rel="stylesheet" href="https://epicenterprograms.github.io/standards/formatting/foundation.css">
		<link rel="stylesheet" href="formatting.css">
		<style>
			#result a {
				font-size: 1.25rem;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<nav class="hidden-left-nav">
			<iframe src="navigation.html"></iframe>
		</nav>
		<h1 class="main-title">
			People finder
		</h1>
		<main>
			<input type="text" id="searchText" placeholder="Type something to search">
			<button id="searchButton">
				Search
			</button>
			<p>
				This will allow you to find things.
			</p>
			<button id="peopleLister">
				List people
			</button>
			<button>
				List topics
			</button>
			<h2>
				Results:
			</h2>
			<ul id="result"></ul>
		</main>
	</body>
</html>
